version: "2.3"

services:
  # plex media server
  plex:
    image: plexinc/pms-docker:plexpass
    container_name: plex
    volumes:
      - ${CONFIG_DIR}/plex:/config
      - ${PLEX_TRANSCODE_DIR}:/transcode
      - ${MEDIA_DIR}:/media
    environment:
      - TZ=Europe/London
    networks:
      lan:
        ipv4_address: ${PLEX_HOST_IP}
    devices:
      - /dev/dri:/dev/dri
    restart: unless-stopped

  # nzbget
  nzbget:
    image: ghcr.io/linuxserver/nzbget
    container_name: nzbget
    volumes:
      - ${CONFIG_DIR}/nzbget:/config
      - ${MEDIA_DIR}/downloads:/downloads
    environment:
      - PUID=1000
      - PGID=1000
    networks:
      proxy:
    labels:
      - "traefik.http.routers.nzbget.rule=Host(`nzbget.${LOCAL_DOMAIN}`)"
    restart: unless-stopped

  hydra:
    image: ghcr.io/linuxserver/nzbhydra2
    container_name: hydra
    volumes:
      - ${CONFIG_DIR}/hydra:/config
    networks:
      proxy:
    labels:
      - "traefik.http.routers.nzbhydra.rule=Host(`nzbhydra.${LOCAL_DOMAIN}`)"
    restart: unless-stopped

  prowlarr:
    image: ghcr.io/linuxserver/prowlarr
    container_name: prowlarr
    volumes:
      - ${CONFIG_DIR}/prowlarr:/config
    ports:
      - 9696:9696
    networks:
      proxy:
    labels:
      - "traefik.http.routers.nzbhydra.rule=Host(`prowlarr.${LOCAL_DOMAIN}`)"
    restart: unless-stopped

  # sonarr
  sonarr:
    image: ghcr.io/linuxserver/sonarr:develop
    container_name: sonarr
    volumes:
      - ${CONFIG_DIR}/sonarr:/config
      - ${MEDIA_DIR}:/media
      - /etc/localtime:/etc/localtime:ro
    environment:
      - PUID=1000
      - PGID=1000
    networks:
      proxy:
    labels:
      - "traefik.http.routers.sonarr.rule=Host(`sonarr.${LOCAL_DOMAIN}`)"
    restart: unless-stopped

  # radarr
  radarr:
    image: ghcr.io/linuxserver/radarr:nightly
    container_name: radarr
    volumes:
      - ${CONFIG_DIR}/radarr:/config
      - ${MEDIA_DIR}:/media
      - /etc/localtime:/etc/localtime:ro
    environment:
      - PUID=1000
      - PGID=1000
    networks:
      proxy:
    labels:
      - "traefik.http.routers.radarr.rule=Host(`radarr.${LOCAL_DOMAIN}`)"
    restart: unless-stopped

networks:
  proxy:
    external:
      name: "${EXTERNAL_NETWORK_NAME}"
  lan:
    name: lan
    driver: macvlan
    driver_opts:
      parent: ${PARENT_NETWORK_ADAPTER}
    ipam:
      config:
        - subnet: ${IP_MASK}
